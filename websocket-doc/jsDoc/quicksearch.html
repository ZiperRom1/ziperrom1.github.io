<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"chat.js.html":{"id":"chat.js.html","title":"Source: chat.js","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Source: chat.js /** * Chat module * * @module lib/chat */ define([ 'jquery', 'module', 'lodash', 'message', 'bootstrap-switch', 'bootstrap-select', 'bootstrap' ], function ($, module, _, Message) { 'use strict'; /** * ChatManager object * * @constructor * @alias module:lib/chat * @param {WebSocket} WebSocket The websocket manager * @param {User} User The current User * @param {FormsManager} Forms A FormsManager to handle form XHR ajax calls or jsCallbacks * @param {Object} settings Overriden settings * * @todo check the id value of the followings * this.mouseInRoomChat * * this.isRoomOpened * this.messagesHistory * this.messagesHistoryPointer * this.messagesCurrent */ var ChatManager = function (WebSocket, User, Forms, settings) { var self = this; this.settings = $.extend(true, {}, this.settings, module.config(), settings); this.websocket = WebSocket; this.user = User; this.initEvents(); // Add websocket callbacks this.websocket.addCallback(this.settings.serviceName, this.chatCallback, this); // Add forms callback Forms.addJsCallback('setReasonCallbackEvent', this.setReasonCallbackEvent, this); Forms.addJsCallback('setRoomInfoCallbackEvent', this.setRoomInfoCallbackEvent, this); // Enable selectpicker and load rooms $(document).ready(function () { $(self.settings.selectors.roomConnect.div + ' ' + self.settings.selectors.roomConnect.name) .selectpicker(); }); this.getRoomsInfo(); }, messageManager = new Message(); ChatManager.prototype = { /*==================================================== = Object settings / properties = ====================================================*/ /** * Default settings will get overriden if they are set when the WebsocketManager will be instanciated */ &quot;settings&quot;: { &quot;users&quot;: [] }, /** * Global promises handler */ &quot;promises&quot;: { &quot;setReason&quot;: $.Deferred() }, /** * List of all commands name and regex */ &quot;commands&quot;: { &quot;kick&quot;: module.config().commands.kick, &quot;pm&quot; : module.config().commands.pm }, /** * The WebsocketManager instance */ &quot;websocket&quot;: {}, /** * The current user message (not sent) by room */ &quot;messagesCurrent&quot;: {}, /** * A messages sent history by room */ &quot;messagesHistory&quot;: {}, /** * Pointer in the array messagesHistory by room */ &quot;messagesHistoryPointer&quot;: {}, /** * Monitor mouse position when it is in or out a room chat div */ &quot;mouseInRoomChat&quot;: {}, /** * Monitor if a room is opened or not */ &quot;isRoomOpened&quot;: {}, /** * The current User instance */ &quot;user&quot;: {}, /** * If the service is currently running on the server */ &quot;serviceRunning&quot;: false, /*===== End of Object settings / properties ======*/ /*============================== = Events = ==============================*/ /** * Initialize all the events */ initEvents: function () { // Connect to a room $('body').on( 'click', this.settings.selectors.roomConnect.div + ' ' + this.settings.selectors.roomConnect.connect, $.proxy(this.connectEvent, this) ); // Create a room $('body').on( 'click', this.settings.selectors.roomCreation.div + ' ' + this.settings.selectors.roomCreation.create, $.proxy(this.createRoomEvent, this) ); // Display a room $('body').on( 'click', this.settings.selectors.global.roomName, $.proxy(this.displayRoomEvent, this) ); // Minimize a room $('body').on( 'click', this.settings.selectors.global.roomMinimize, $.proxy(this.minimizeRoomEvent, this) ); // Fullscreen a room $('body').on( 'click', this.settings.selectors.global.roomFullscreen, $.proxy(this.fullscreenRoomEvent, this) ); // Close a room $('body').on( 'click', this.settings.selectors.global.roomClose, $.proxy(this.closeRoomEvent, this) ); // Listen the &quot;enter&quot; keypress event on the chat text input $('body').on( 'keydown', this.settings.selectors.global.room + ' ' + this.settings.selectors.roomSend.div + ' ' + this.settings.selectors.roomSend.message, $.proxy(this.chatTextKeyPressEvent, this) ); // Send a message in a room $('body').on( 'click', this.settings.selectors.global.room + ' ' + this.settings.selectors.roomSend.div + ' ' + this.settings.selectors.roomSend.send, $.proxy(this.sendMessageEvent, this) ); // Load more messages in a room $('body').on( 'click', this.settings.selectors.global.room + ' ' + this.settings.selectors.roomAction.loadHistoric, $.proxy(this.getHistoricEvent, this) ); // Select a reciever for the chat message $('body').on( 'click', this.settings.selectors.global.room + ' ' + this.settings.selectors.roomSend.usersList + ' li a', $.proxy(this.selectUserEvent, this) ); // Monitor the mouse when it is in a roomChat div $('body').on( 'mouseenter', this.settings.selectors.global.roomChat, $.proxy(this.mouseEnterRoomChatEvent, this) ); // Monitor the mouse when it is not in a roomChat div $('body').on( 'mouseleave', this.settings.selectors.global.roomChat, $.proxy(this.mouseLeaveRoomChatEvent, this) ); // Set the modal admin contents before it is opened $('body').on( 'show.bs.modal', this.settings.selectors.administrationPanel.div, $.proxy(this.setAministrationPanelEvent, this) ); // Toggle the user right in the administration panel $('body').on( 'click', this.settings.selectors.administrationPanel.modal + ' ' + this.settings.selectors.administrationPanel.toggleRights, $.proxy(this.toggleAdministrationRights, this) ); // Kick a user from a room in the administration panel $('body').on( 'click', this.settings.selectors.administrationPanel.modal + ' ' + this.settings.selectors.administrationPanel.kick, $.proxy(this.kickUserEvent, this) ); // Ban a user from a room in the administration panel $('body').on( 'click', this.settings.selectors.administrationPanel.modal + ' ' + this.settings.selectors.administrationPanel.ban, $.proxy(this.banUserEvent, this) ); // Show / hide the password input when the selected room is public / private $('body').on( 'change', this.settings.selectors.roomConnect.div + ' ' + this.settings.selectors.roomConnect.name, $.proxy(this.selectRoomEvent, this) ); }, /** * Event fired when a user want to connect to a chat * * @method connectEvent */ connectEvent: function () { var connectDiv = $(this.settings.selectors.roomConnect.div), pseudonym = connectDiv.find(this.settings.selectors.roomConnect.pseudonym).val(), roomId = connectDiv.find('select' + this.settings.selectors.roomConnect.name).val(), password = connectDiv.find(this.settings.selectors.roomConnect.password).val(); //@todo error message when no room selected... this.connect(pseudonym, roomId, password); }, /** * Event fired when a user wants to create a chat room * * @method createRoomEvent */ createRoomEvent: function () { var createDiv = $(this.settings.selectors.roomCreation.div), roomName = createDiv.find(this.settings.selectors.roomCreation.name).val(), type = createDiv.find(this.settings.selectors.roomCreation.type).val(), password = createDiv.find(this.settings.selectors.roomCreation.password).val(), maxUsers = createDiv.find(this.settings.selectors.roomCreation.maxUsers).val(); this.createRoom(roomName, type, password, maxUsers); }, /** * Event fired when a user wants to display a room * * @method displayRoomEvent * @param {event} e The fired event */ displayRoomEvent: function (e) { $(e.currentTarget).closest(this.settings.selectors.global.roomHeader) .next(this.settings.selectors.global.roomContents) .slideDown(this.settings.animationTime); this.isRoomOpened[$(e.currentTarget).closest(this.settings.selectors.global.room).attr('data-id')] = true; }, /** * Event fired when a user wants to minimize a room * * @method minimizeRoomEvent * @param {event} e The fired event */ minimizeRoomEvent: function (e) { $(e.currentTarget).closest(this.settings.selectors.global.roomHeader) .next(this.settings.selectors.global.roomContents) .slideUp(this.settings.animationTime); this.isRoomOpened[ $(e.currentTarget).closest(this.settings.selectors.global.room).attr('data-id') ] = false; }, /** * Event fired when a user wants to fullscreen / reduce a room * * @method fullscreenRoomEvent * @param {event} e The fired event */ fullscreenRoomEvent: function (e) { var room = $(e.currentTarget).closest(this.settings.selectors.global.room); if ($(e.currentTarget).hasClass('glyphicon-fullscreen')) { room.css('width', '100%'); $(e.currentTarget).removeClass('glyphicon-fullscreen'); $(e.currentTarget).addClass('glyphicon-resize-small'); } else { room.removeAttr('style'); $(e.currentTarget).removeClass('glyphicon-resize-small'); $(e.currentTarget).addClass('glyphicon-fullscreen'); } }, /** * Event fired when a user wants to close a room * * @method closeRoomEvent * @param {event} e The fired event */ closeRoomEvent: function (e) { var room = $(e.currentTarget).closest(this.settings.selectors.global.room), roomId = room.attr('data-id'); this.disconnect(roomId); delete this.isRoomOpened[roomId]; delete this.mouseInRoomChat[roomId]; room.remove(); }, /** * Event fired when a user press a key in a chat message input * * @method chatTextKeyPressEvent * @param {event} e The fired event */ chatTextKeyPressEvent: function (e) { var room = $(e.currentTarget).closest(this.settings.selectors.global.room), roomId = room.attr('data-id'); if (e.which === 13) { // Enter key pressed this.sendMessageEvent(e); } else if (e.which === 38) { // Up arrow key pressed if (this.messagesHistoryPointer[roomId] &gt; 0) { if (this.messagesHistoryPointer[roomId] === this.messagesHistory[roomId].length) { this.messagesCurrent[roomId] = $(e.currentTarget).val(); } $(e.currentTarget).val(this.messagesHistory[roomId][--this.messagesHistoryPointer[roomId]]); } } else if (e.which === 40) { // Down arrow key pressed if (this.messagesHistoryPointer[roomId] + 1 &lt; this.messagesHistory[roomId].length) { $(e.currentTarget).val(this.messagesHistory[roomId][++this.messagesHistoryPointer[roomId]]); } else if (this.messagesHistoryPointer[roomId] + 1 === this.messagesHistory[roomId].length) { this.messagesHistoryPointer[roomId]++; $(e.currentTarget).val(this.messagesCurrent[roomId]); } } }, /** * Event fired when a user wants to send a message * * @method sendMessageEvent * @param {event} e The fired event */ sendMessageEvent: function (e) { var sendDiv = $(e.currentTarget).closest( this.settings.selectors.global.room + ' ' + this.settings.selectors.roomSend.div ), recievers = sendDiv.find(this.settings.selectors.roomSend.recievers).attr('data-value'), messageInput = sendDiv.find(this.settings.selectors.roomSend.message), message = messageInput.val(), room = $(e.currentTarget).closest(this.settings.selectors.global.room), roomId = room.attr('data-id'), password = room.attr('data-password'); if (_.trim(message) !== '') { if (!this.isCommand(message, roomId, password)) { this.sendMessage(recievers, message, roomId, password); } this.messagesHistory[roomId].push(message); this.messagesHistoryPointer[roomId]++; messageInput.val(''); } e.preventDefault(); }, /** * Event fired when a user wants to get more historic of a conversation * * @method getHistoricEvent * @param {event} e The fired event */ getHistoricEvent: function (e) { var room = $(e.currentTarget).closest(this.settings.selectors.global.room), roomId = room.attr('data-id'), password = room.attr('data-password'), historicLoaded = room.find(this.settings.selectors.global.roomChat).attr('data-historic-loaded'); this.getHistoric(roomId, password, historicLoaded); }, /** * Event fired when a user wants to select a reciever for his message * * @method selectUserEvent * @param {event} e The fired event */ selectUserEvent: function (e) { var value = $(e.currentTarget).closest('li').attr('data-value'), recievers = $(e.currentTarget).closest(this.settings.selectors.roomSend.usersList) .siblings(this.settings.selectors.roomSend.recievers); recievers.attr('data-value', value); recievers.find('.value').text(value); e.preventDefault(); }, /** * Event fired when the user mouse enters the room chat div * * @method mouseEnterRoomChatEvent * @param {event} e The fired event */ mouseEnterRoomChatEvent: function (e) { var roomId = $(e.currentTarget).closest(this.settings.selectors.global.room).attr('data-id'); this.mouseInRoomChat[roomId] = true; }, /** * Event fired when the user mouse leaves the room chat div * * @method mouseLeaveRoomChatEvent * @param {event} e The fired event */ mouseLeaveRoomChatEvent: function (e) { var roomId = $(e.currentTarget).closest(this.settings.selectors.global.room).attr('data-id'); this.mouseInRoomChat[roomId] = false; }, /** * Event fired when the user wants to display the administration room panel * * @method setAministrationPanelEvent * @param {event} e The fired event */ setAministrationPanelEvent: function (e) { var modal = $(e.currentTarget); modal.find(this.settings.selectors.administrationPanel.rights + ' input[type=&quot;checkbox&quot;]') .bootstrapSwitch(); }, /** * Event fired when the user wants to display a user rights in administration modal * * @method toggleAdministrationRights * @param {event} e The fired event */ toggleAdministrationRights: function (e) { $(e.currentTarget).closest('tbody').find($(e.currentTarget).attr('data-refer')).toggle(); }, /** * Event fired when a user wants to kick another user from a room in the administration panel * * @method kickUserEvent * @param {event} e The fired event */ kickUserEvent: function (e) { var pseudonym = $(e.currentTarget).closest('tr').attr('data-pseudonym'), modal = $(e.currentTarget).closest(this.settings.selectors.administrationPanel.modal), roomId = modal.attr('data-room-id'), self = this; $(modal).fadeOut(this.settings.animationTime, function () { $(self.settings.selectors.alertInputsChoice.div).fadeIn(self.settings.animationTime); }); $.when(this.promises.setReason).done(function (reason) { self.kickUser(roomId, pseudonym, reason); $(modal).fadeIn(self.settings.animationTime); }); }, /** * Event fired when a user wants to ban another user from a room in the administration panel * * @method banUserEvent * @param {event} e The fired event */ banUserEvent: function (e) { var pseudonym = $(e.currentTarget).closest('tr').attr('data-pseudonym'), modal = $(e.currentTarget).closest(this.settings.selectors.administrationPanel.modal), roomId = modal.attr('data-room-id'), self = this; $(modal).fadeOut(this.settings.animationTime, function () { $(self.settings.selectors.alertInputsChoice.div).fadeIn(self.settings.animationTime); }); $.when(this.promises.setReason).done(function (reason) { self.banUser(roomId, pseudonym, reason); $(modal).fadeIn(self.settings.animationTime); }); }, /** * Set the reason of the admin kick / ban action * * @method setReasonCallbackEvent * @param {Object} form The jQuery DOM form element * @param {Object} inputs The user inputs as object */ setReasonCallbackEvent: function (form, inputs) { var self = this; $(this.settings.selectors.alertInputsChoice.div).fadeOut(this.settings.animationTime, function () { self.promises.setReason.resolve(_.find(inputs, {&quot;name&quot;: &quot;reason&quot;}).value); self.promises.setReason = $.Deferred(); form[0].reset(); }); }, /** * Set the room name / password * * @method setRoomInfoCallbackEvent * @param {Object} form The jQuery DOM form element * @param {Object} inputs The user inputs as object */ setRoomInfoCallbackEvent: function (form, inputs) { var modal = form.closest(this.settings.selectors.administrationPanel.modal), roomId = modal.attr('data-room-id'), oldRoomName = modal.attr('data-room-name'), newRoomName = _.find(inputs, {&quot;name&quot;: &quot;roomName&quot;}).value, oldRoomPassword = modal.attr('data-room-password'), newRoomPassword = _.find(inputs, {&quot;name&quot;: &quot;roomPassword&quot;}).value; if (oldRoomName !== newRoomName || oldRoomPassword !== newRoomPassword) { this.setRoomInfo(roomId, oldRoomName, newRoomName, oldRoomPassword, newRoomPassword); } }, /** * Event fired when a user selected a room * * @method selectRoomEvent * @param {event} e The fired event */ selectRoomEvent: function (e) { if ($(e.currentTarget).find('option:selected').attr('data-type') === 'public') { $(this.settings.selectors.roomConnect.div + ' ' + this.settings.selectors.roomConnect.password).hide(); } else { $(this.settings.selectors.roomConnect.div + ' ' + this.settings.selectors.roomConnect.password).show(); } }, /*===== End of Events ======*/ /*================================================================== = Actions that query to the WebSocket server = ==================================================================*/ /** * Connect a user to the chat * * @method connect * @param {String} pseudonym The user pseudonym * @param {Number} roomId The room ID to connect to * @param {String} password The room password to connect to */ connect: function (pseudonym, roomId, password) { this.websocket.send(JSON.stringify({ &quot;service&quot; : [this.settings.serviceName], &quot;action&quot; : &quot;connectRoom&quot;, &quot;pseudonym&quot;: pseudonym || &quot;&quot;, &quot;roomId&quot; : roomId, &quot;password&quot; : password })); }, /** * Disconnect a user from a chat room * * @method disconnect * @param {Number} roomId The room ID to disconnect to */ disconnect: function (roomId) { this.websocket.send(JSON.stringify({ &quot;service&quot;: [this.settings.serviceName], &quot;action&quot; : &quot;disconnectFromRoom&quot;, &quot;roomId&quot; : roomId })); }, /** * Send a message to all the users in the chat room or at one user in the chat room * * @method sendMessage * @param {String} recievers The message reciever ('all' || userPseudonym) * @param {String} message The txt message to send * @param {Number} roomId The chat room name * @param {String} password The chat room password if required */ sendMessage: function (recievers, message, roomId, password) { this.websocket.send(JSON.stringify({ &quot;service&quot; : [this.settings.serviceName], &quot;action&quot; : &quot;sendMessage&quot;, &quot;roomId&quot; : roomId, &quot;message&quot; : message, &quot;recievers&quot;: recievers, &quot;password&quot; : password || '' })); }, /** * Create a chat room * * @method createRoom * @param {String} roomName The room name * @param {String} type The room type ('public' || 'private') * @param {String} password The room password * @param {Number} maxUsers The max users number */ createRoom: function (roomName, type, password, maxUsers) { this.websocket.send(JSON.stringify({ &quot;service&quot; : [this.settings.serviceName], &quot;action&quot; : &quot;createRoom&quot;, &quot;roomName&quot; : roomName, &quot;roomPassword&quot;: password, &quot;type&quot; : type, &quot;maxUsers&quot; : maxUsers })); }, /** * Get room chat historic * * @method getHistoric * @param {Number} roomId The room ID * @param {String} password The room password * @param {Number} historicLoaded The number of historic already loaded */ getHistoric: function (roomId, password, historicLoaded) { this.websocket.send(JSON.stringify({ &quot;service&quot; : [this.settings.serviceName], &quot;action&quot; : &quot;getHistoric&quot;, &quot;roomId&quot; : roomId, &quot;roomPassword&quot; : password, &quot;historicLoaded&quot;: historicLoaded })); }, /** * Kick a user from a room * * @method kickUser * @param {Number} roomId The room ID * @param {String} pseudonym The user pseudonym to kick * @param {String} reason OPTIONAL the reason of the kick */ kickUser: function (roomId, pseudonym, reason) { this.websocket.send(JSON.stringify({ &quot;service&quot; : [this.settings.serviceName], &quot;action&quot; : &quot;kickUser&quot;, &quot;roomId&quot; : roomId, &quot;pseudonym&quot;: pseudonym, &quot;reason&quot; : reason })); }, /** * Ban a user from a room * * @method banUser * @param {Number} roomId The room ID * @param {String} pseudonym The user pseudonym to ban * @param {String} reason OPTIONAL the reason of the ban */ banUser: function (roomId, pseudonym, reason) { this.websocket.send(JSON.stringify({ &quot;service&quot; : [this.settings.serviceName], &quot;action&quot; : &quot;banUser&quot;, &quot;roomId&quot; : roomId, &quot;pseudonym&quot;: pseudonym, &quot;reason&quot; : reason })); }, /** * Update a user right * * @method updateRoomUserRight * @param {Number} roomId The room ID * @param {String} pseudonym The user pseudonym * @param {String} rightName The right name to update * @param {Boolean} rightValue The new right value */ updateRoomUserRight: function (roomId, pseudonym, rightName, rightValue) { this.websocket.send(JSON.stringify({ &quot;service&quot; : [this.settings.serviceName], &quot;action&quot; : &quot;updateRoomUserRight&quot;, &quot;roomId&quot; : roomId, &quot;pseudonym&quot; : pseudonym, &quot;rightName&quot; : rightName, &quot;rightValue&quot;: rightValue })); }, /** * Set a new room name / password * * @method setRoomInfo * @param {Number} roomId The room ID * @param {String} oldRoomName The old room name * @param {String} newRoomName The new room name * @param {String} oldRoomPassword The old room password * @param {String} newRoomPassword The new room password */ setRoomInfo: function (roomId, oldRoomName, newRoomName, oldRoomPassword, newRoomPassword) { this.websocket.send(JSON.stringify({ &quot;service&quot; : [this.settings.serviceName], &quot;action&quot; : &quot;setRoomInfo&quot;, &quot;roomId&quot; : roomId, &quot;oldRoomName&quot; : oldRoomName, &quot;newRoomName&quot; : newRoomName, &quot;oldRoomPassword&quot;: oldRoomPassword, &quot;newRoomPassword&quot;: newRoomPassword })); }, /** * Get the rooms basic information (name, type, usersMax, usersConnected) * * @method getRoomsInfo */ getRoomsInfo: function () { this.websocket.send(JSON.stringify({ &quot;service&quot;: [this.settings.serviceName], &quot;action&quot; : &quot;getRoomsInfo&quot; })); }, /*===== End of Actions that query to the WebSocket server ======*/ /*================================================================== = Callbacks after WebSocket server responses = ==================================================================*/ /** * Handle the WebSocker server response and process action then * * @method chatCallback * @param {Object} data The server JSON reponse */ chatCallback: function (data) { if (typeof this[data.action + 'Callback'] === 'function') { this[data.action + 'Callback'](data); } else if (data.text) { messageManager.add(data.text); } }, /** * Callback after a user attempted to connect to a room * * @method connectRoomCallback * @param {Object} data The server JSON reponse */ connectRoomCallback: function (data) { if (data.success) { this.insertRoomInDOM(data); } messageManager.add(data.text); }, /** * Callback after a user attempted to disconnect from a room * * @method disconnectRoomCallback * @param {Object} data The server JSON reponse */ disconnectRoomCallback: function (data) { messageManager.add(data.text); }, /** * Callback after a user joined or left the room * * @method updateRoomUsersCallback * @param {Object} data The server JSON reponse */ updateRoomUsersCallback: function (data) { var room = $(this.settings.selectors.global.room + '[data-id=&quot;' + data.roomId + '&quot;]'), usersList, newPseudonyms, oldPseudonyms, modal, users, self; if (room.length &gt; 0) { usersList = room.attr('data-users').split(','); room.attr('data-users', _(data.pseudonyms).toString()); this.updateUsersDropdown(room, data.pseudonyms); // Update the administration panel if (this.user.connected) { newPseudonyms = _.difference(data.pseudonyms, usersList); oldPseudonyms = _.difference(usersList, data.pseudonyms); modal = $('.modal[data-room-id=&quot;' + data.roomId + '&quot;]'); users = modal.find(this.settings.selectors.administrationPanel.usersList); self = this; _.forEach(newPseudonyms, function (pseudonym) { users.append( self.getUserRightLine(modal, pseudonym, data.right) ); }); _.forEach(oldPseudonyms, function (pseudonym) { users.find('tr[data-pseudonym=&quot;' + pseudonym + '&quot;]').remove(); }); } } }, /** * Callback after a registered user entered or left the room * * @method updateRoomUsersRightsCallback * @param {Object} data The server JSON reponse */ updateRoomUsersRightsCallback: function (data) { var modal = $('.modal[data-room-id=&quot;' + data.room.id + '&quot;]'); this.updateRoomUsersRights(modal, data.usersRights); }, /** * Callback after a user get banned or unbanned from a room * * @method updateRoomUsersBannedCallback * @param {Object} data The server JSON reponse */ updateRoomUsersBannedCallback: function (data) { var modal = $('.modal[data-room-id=&quot;' + data.room.id + '&quot;]'); this.updateRoomUsersBanned(modal, data.usersBanned); }, /** * Callback after a user attempted to create a room * * @method createRoomCallback * @param {Object} data The server JSON reponse */ createRoomCallback: function (data) { if (data.success) { this.insertRoomInDOM(data); } messageManager.add(data.text); }, /** * Callback after a user recieved a message * * @method recieveMessageCallback * @param {Object} data The server JSON reponse */ recieveMessageCallback: function (data) { var room = $(this.settings.selectors.global.room + '[data-id=&quot;' + data.roomId + '&quot;]'), roomChat = room.find(this.settings.selectors.global.roomChat), messagesUnread = room.find(this.settings.selectors.global.roomMessagesUnread), messagesUnreadValue = messagesUnread.text(); roomChat.append(this.formatUserMessage(data)); if (this.isRoomOpened[data.roomId] &amp;&amp; !this.mouseInRoomChat[data.roomId]) { roomChat.scrollTop(room.height()); messagesUnread.text(''); } else { if (messagesUnreadValue === '') { messagesUnread.text('1'); } else { messagesUnread.text(++messagesUnreadValue); } } }, /** * Callback after a user sent a message * * @method sendMessageCallback * @param {Object} data The server JSON reponse */ sendMessageCallback: function (data) { if (!data.success) { messageManager.add(data.text); } }, /** * Callback after a user attempted to laod more historic of a conversation * * @method getHistoricCallback * @param {Object} data The server JSON reponse */ getHistoricCallback: function (data) { var room = $(this.settings.selectors.global.room + '[data-id=&quot;' + data.roomId + '&quot;]'), roomChat = room.find(this.settings.selectors.global.roomChat); this.loadHistoric(roomChat, data.historic); messageManager.add(data.text); }, /** * Callback after being kicked from a room * * @method getKickedCallback * @param {Object} data The server JSON reponse */ getKickedCallback: function (data) { messageManager.add(data.text); }, /** * Callback after kicking a user from a room * * @method kickUserCallback * @param {Object} data The server JSON reponse */ kickUserCallback: function (data) { messageManager.add(data.text); }, /** * Callback after being banned from a room * * @method getBannedCallback * @param {Object} data The server JSON reponse */ getBannedCallback: function (data) { messageManager.add(data.text); }, /** * Callback after banning a user from a room * * @method banUserCallback * @param {Object} data The server JSON reponse */ banUserCallback: function (data) { messageManager.add(data.text); }, /** * Callback after setting a new room name / password * * @method setRoomInfoCallback * @param {Object} data The server JSON reponse */ setRoomInfoCallback: function (data) { messageManager.add(data.text); }, /** * Callback after a room name / password has been changed * * @method changeRoomInfoCallback * @param {Object} data The server JSON reponse */ changeRoomInfoCallback: function (data) { var room = $(this.settings.selectors.global.room + '[data-id=&quot;' + data.id + '&quot;]'), modal; if (data.oldRoomName !== data.newRoomName) { room.attr('data-name', data.newRoomName); room.find(this.settings.selectors.global.roomName).text(data.newRoomName); } if (data.oldRoomPassword !== data.newRoomPassword) { room.attr('data-password', data.newRoomPassword); } if (this.user.connected) { modal = $(this.settings.selectors.administrationPanel.modal + '[data-room-id=&quot;' + data.id + '&quot;]'); if (data.oldRoomName !== data.newRoomName) { modal.attr('data-room-name', data.newRoomName); modal.find(this.settings.selectors.administrationPanel.roomName).text(data.newRoomName); modal.find(this.settings.selectors.administrationPanel.inputRoomName).val(data.newRoomName); } if (data.oldRoomPassword !== data.newRoomPassword) { modal.attr('data-room-password', data.newRoomPassword); modal.find(this.settings.selectors.administrationPanel.inputRoomPassword).val(data.newRoomPassword); } } this.recieveMessageCallback(data); }, /** * Callback after getting the new rooms info * * @method getRoomsInfoCallback * @param {Object} data The server JSON reponse */ getRoomsInfoCallback: function (data) { var publicRooms = [], privateRooms = [], select = $( this.settings.selectors.roomConnect.div + ' ' + this.settings.selectors.roomConnect.name ), option; _.forEach(data.roomsInfo, function (roomInfo) { option = $('&lt;option&gt;', { &quot;value&quot; : roomInfo.room.id, &quot;data-subtext&quot;: '(' + roomInfo.usersConnected + '/' + roomInfo.room.maxUsers + ')', &quot;data-type&quot; : roomInfo.room.password ? 'private' : 'public', &quot;text&quot; : roomInfo.room.name }); if (roomInfo.room.password) { privateRooms.push(option); } else { publicRooms.push(option); } }); select.find(this.settings.selectors.roomConnect.publicRooms).html(publicRooms); select.find(this.settings.selectors.roomConnect.privateRooms).html(privateRooms); select.selectpicker('refresh'); }, /*===== End of Callbacks after WebSocket server responses ======*/ /*========================================= = Utilities methods = =========================================*/ /** * Insert a room in the user DOM with data recieved from server * * @method insertRoomInDOM * @param {Object} data The server JSON reponse */ insertRoomInDOM: function (data) { var roomData = data.room, room = $(this.settings.selectors.global.room + '[data-id=&quot;' + roomData.id + '&quot;]'), roomSample, newRoom, newRoomChat, modalSample, newModal, id; if (room.length === 0) { // Room chat creation if the room does not exist yet roomSample = $(this.settings.selectors.global.roomSample); newRoom = roomSample.clone(true); newRoomChat = newRoom.find(this.settings.selectors.global.roomChat); newRoom.attr({ &quot;data-id&quot; : roomData.id, &quot;data-name&quot; : roomData.name, &quot;data-type&quot; : roomData.password ? 'private' : 'public', &quot;data-pseudonym&quot;: data.pseudonym, &quot;data-password&quot; : roomData.password, &quot;data-max-users&quot;: roomData.maxUsers, &quot;data-users&quot; : _(data.pseudonyms).toString() }); newRoom.removeAttr('id'); newRoom.removeClass('hide'); newRoom.find(this.settings.selectors.global.roomName).text(roomData.name); newRoom.find(this.settings.selectors.roomAction.showUsers).popover({ content: function () { var list = $('&lt;ul&gt;'); _.forEach(newRoom.attr('data-users').split(','), function (pseudonym) { list.append($('&lt;li&gt;', {&quot;text&quot;: pseudonym})); }); return list.html(); } }); newRoomChat.attr('data-historic-loaded', 0); this.updateUsersDropdown(newRoom, data.pseudonyms); // @todo historic this.loadHistoric(newRoomChat, data.historic); this.mouseInRoomChat[roomData.id] = false; this.isRoomOpened[roomData.id] = true; this.messagesHistory[roomData.id] = []; this.messagesHistoryPointer[roomData.id] = 0; this.messagesCurrent[roomData.id] = ''; $(this.settings.selectors.global.chat).append(newRoom); // Modal room chat administration creation if the user is registered if (this.user.isConnected()) { modalSample = $(this.settings.selectors.administrationPanel.modalSample); newModal = modalSample.clone(); id = 'chat-admin-' + roomData.id; newModal.attr({ &quot;id&quot; : id, &quot;data-room-id&quot; : roomData.id, &quot;data-room-name&quot; : roomData.name, &quot;data-room-password&quot;: roomData.password }); newModal.find(this.settings.selectors.administrationPanel.roomName).text(roomData.name); newModal.find(this.settings.selectors.administrationPanel.inputRoomName).val(roomData.name); newModal.find(this.settings.selectors.administrationPanel.inputRoomPassword).val(roomData.password); newRoom.find(this.settings.selectors.roomAction.administration).attr('data-target', '#' + id); this.updateRoomUsersRights(newModal, data.chatRights); modalSample.after(newModal); } } else if (data.historic) { this.loadHistoric(room.find(this.settings.selectors.global.roomChat), data.historic); } }, /** * Load conversations historic sent by the server * * @method loadHistoric * @param {Object} roomChatDOM The room chat jQuery DOM element to insert the conversations historic in * @param {Object} historic The conversations historic */ loadHistoric: function (roomChatDOM, historic) { var historicLoaded = roomChatDOM.attr('data-historic-loaded'), i; if (historic !== undefined) { for (i = historic.length - 1; i &gt;= 0; i--) { roomChatDOM.prepend(this.formatUserMessage(historic[i])); } roomChatDOM.attr('data-historic-loaded', ++historicLoaded); } }, /** * Format a user message in a html div * * @method formatUserMessage * @param {Object} data The server JSON reponse * @return {Array} Array of jQuery html div(s) object containing the user message(s) */ formatUserMessage: function (data) { var divs = [], self = this; if (!_.isArray(data.text)) { data.text = [data.text]; } _.forEach(data.text, function (text) { divs.push( $('&lt;div&gt;', { &quot;class&quot;: self.settings.selectors.chat.message.substr(1) + ' ' + data.type }).append( $('&lt;span&gt;', { &quot;class&quot;: self.settings.selectors.chat.date.substr(1), &quot;text&quot; : '[' + data.time + ']' }), $('&lt;span&gt;', { &quot;class&quot;: self.settings.selectors.chat.pseudonym.substr(1), &quot;text&quot; : data.pseudonym }), $('&lt;span&gt;', { &quot;class&quot;: self.settings.selectors.chat.text.substr(1), &quot;text&quot; : text }) ) ); }); return divs; }, /** * Update the users list in the dropdown menu recievers * * @method updateUsersDropdown * @param {Object} room The room jQuery DOM element * @param {Array} pseudonyms The new pseudonyms list */ updateUsersDropdown: function (room, pseudonyms) { var list = []; list.push($('&lt;li&gt;', { &quot;data-value&quot;: &quot;all&quot; }).append($('&lt;a&gt;', { &quot;href&quot; : &quot;#&quot;, &quot;title&quot;: &quot;all&quot;, &quot;text&quot; : &quot;all&quot; }))); _.forEach(pseudonyms, function (pseudonym) { if (pseudonym !== room.attr('data-pseudonym')) { list.push($('&lt;li&gt;', { &quot;data-value&quot;: pseudonym }).append($('&lt;a&gt;', { &quot;href&quot; : &quot;#&quot;, &quot;title&quot;: pseudonym, &quot;text&quot; : pseudonym }))); } }); room.find(this.settings.selectors.roomSend.div + ' ' + this.settings.selectors.roomSend.usersList) .html(list); }, /** * Update the users list in the administration modal * * @method updateRoomUsersRights * @param {Object} modal The modal jQuery DOM element * @param {Object} usersRights The users rights object returned by the server */ updateRoomUsersRights: function (modal, usersRights) { var usersList = modal.find(this.settings.selectors.administrationPanel.usersList), trSample = usersList.find(this.settings.selectors.administrationPanel.trSample), roomId = modal.attr('data-room-id'), room = $(this.settings.selectors.global.room + '[data-id=&quot;' + roomId + '&quot;]'), newLines = [], self = this; if (room.length &gt; 0) { _.forEach(room.attr('data-users').split(','), function (pseudonym) { newLines.push(self.getUserRightLine(modal, pseudonym, usersRights[pseudonym])); }); // Clean and insert lines usersList.find('tr').not(trSample).remove(); trSample.last().after(newLines); } }, /** * Get a new user right line in the administration panel * * @method getUserRightLine * @param {Object} modal The modal jQuery DOM element * @param {String} pseudonym The new user pseudonym * @param {Object} userChatRight The new user chat right * @return {Object} The new user right line jQuery DOM element */ getUserRightLine: function (modal, pseudonym, userChatRight) { var usersList = modal.find(this.settings.selectors.administrationPanel.usersList), trSample = usersList.find(this.settings.selectors.administrationPanel.trSample), roomId = modal.attr('data-room-id'), newLine = trSample.clone(), refer = _.uniqueId('right-'), self = this, input, rightName; newLine.removeClass('hide sample'); newLine.attr('data-pseudonym', pseudonym); newLine.find(this.settings.selectors.administrationPanel.pseudonym).text(pseudonym); newLine.find(this.settings.selectors.administrationPanel.toggleRights).attr('data-refer', '.' + refer); newLine.each(function () { if ($(this).hasClass(self.settings.selectors.administrationPanel.rights.substr(1))) { input = $(this).find('input'); rightName = input.attr('name'); $(this).addClass(refer); // Unregistered user if (!userChatRight) { // Disabled rights on unregistered users input.bootstrapSwitch('readonly', true); input.bootstrapSwitch('state', false); } else { // Set the current user rights input.bootstrapSwitch( 'state', userChatRight[roomId] ? userChatRight[roomId][rightName] : false ); if (!self.user.getChatRoomRight(roomId) || !self.user.getChatRoomRight(roomId).grant) { // Disabled rights if the admin have no &quot;grant&quot; right input.bootstrapSwitch('readonly', true); } else { // Bind event on right change event to update the right instantly input.on('switchChange.bootstrapSwitch', function (ignore, rightValue) { self.updateRoomUserRight(roomId, pseudonym, $(this).attr('name'), rightValue); }); } } } }); return newLine; }, /** * Update the ip banned list in the administration modal * * @method updateRoomUsersBanned * @param {Object} modal The modal jQuery DOM element * @param {Object} usersBanned The users banned object returned by the server */ updateRoomUsersBanned: function (modal, usersBanned) { var bannedList = modal.find(this.settings.selectors.administrationPanel.bannedList), trSample = bannedList.find(this.settings.selectors.administrationPanel.trSample), newLines = [], self = this; _.forEach(usersBanned, function (bannedInfo) { var newLine = trSample.clone(); newLine.removeClass('hide sample'); newLine.find(self.settings.selectors.administrationPanel.ip).text(bannedInfo.ip); newLine.find(self.settings.selectors.administrationPanel.pseudonymBanned).text(bannedInfo.pseudonym); newLine.find(self.settings.selectors.administrationPanel.pseudonymAdmin).text(bannedInfo.admin); newLine.find(self.settings.selectors.administrationPanel.reason).text(bannedInfo.reason); newLine.find(self.settings.selectors.administrationPanel.date).text(bannedInfo.date); newLines.push(newLine); }); // Clean and insert lines bannedList.find('tr').not(trSample).remove(); trSample.last().after(newLines); }, /** * Check if the user input is a command and process it * * @method isCommand * @param {String} message The user input * @param {String} roomName The room name * @param {String} password The room password * @return {Boolean} True if the user input was a command else false */ isCommand: function (message, roomName, password) { var isCommand = false, self = this, regexResult; _.forEach(this.commands, function (regex, name) { regexResult = regex.exec(message); if (regexResult !== null) { isCommand = true; switch (name) { case 'kick': self.kickUser(roomName, regexResult[1], regexResult[2] || ''); break; case 'pm': self.sendMessage(regexResult[1], regexResult[2], roomName, password); break; } return false; } }); return isCommand; } /*===== End of Utilities methods ======*/ }; return ChatManager; }); × Search results Close "},"forms.js.html":{"id":"forms.js.html","title":"Source: forms.js","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Source: forms.js /** * Forms module * * @module lib/forms * @exports lib/vendors/jquery-2.1.4 */ define([ 'jquery', 'domReady!' ], function ($) { 'use strict'; /** * FormsManager object * * @constructor * @alias module:lib/forms * @param {Object} settings Overriden settings */ var FormsManager = function (settings) { this.settings = $.extend(true, {}, this.settings, settings); this.initEvents(); }; FormsManager.prototype = { /** * Default settings will get overriden if they are set when the FormsManager will be instanciated */ &quot;settings&quot; : { }, /** * The currents xhr processing */ &quot;xhrs&quot;: [], /** * Callbacks methods to process specifics responses on a XHR server response */ &quot;callbacks&quot;: { 'onSuccess' : [], 'onFail' : [], 'onRequestFail': [] }, /** * Callbacks methods to process users input on user sumbit action */ &quot;jsCallbacks&quot;: {}, /** * Bind events on all form */ initEvents: function () { $('body').on('submit', 'form', $.proxy(this.submit, this)); }, /** * Process the form with specified method in the data-send-action HTML attribute (default AJAX call) * * @param {event} e The form submit event */ submit: function (e) { var form = $(e.currentTarget), self = this, url; switch (form.attr('data-send-action')) { case 'jsCallback': e.preventDefault(); this.onJsCallback(form, form.attr('data-callback-name'), form.serializeArray()); break; default: e.preventDefault(); url = form.attr('action'); if (this.xhrs[url]) { this.xhrs[url].abort(); } this.xhrs[url] = $.ajax({ url : url, type : form.attr('method'), dataType: 'json', data : form.serialize() }).done(function (data) { if (data.success) { self.onSuccess(form, url, data); } else { self.onFail(form, url, data); } }).fail(function (jqXHR) { self.onRequestFail(form, url, jqXHR); }).always(function () { delete self.xhrs[url]; }); } }, /** * Processing method on server success response * * @param {Object} form The jQuery DOM form element * @param {String} url The URL called to send the user data * @param {Object} data The server JSON reponse */ onSuccess: function (form, url, data) { if (this.callbacks.onSuccess[url] &amp;&amp; typeof this.callbacks.onSuccess[url].callback === 'function') { this.callbacks.onSuccess[url].callback.call(this.callbacks.onSuccess[url].context, form, data); } }, /** * Processing method on server fail response * * @param {Object} form The jQuery DOM form element * @param {String} url The URL called to send the user data * @param {Object} data The server JSON reponse */ onFail: function (form, url, data) { if (this.callbacks.onFail[url] &amp;&amp; typeof this.callbacks.onFail[url].callback === 'function') { this.callbacks.onFail[url].callback.call(this.callbacks.onFail[url].context, form, data); } }, /** * Processing method on XHR error * * @param {Object} form The jQuery DOM form element * @param {String} url The URL called to send the user data * @param {Object} jqXHR The jQuery jqXHR object */ onRequestFail: function (form, url, jqXHR) { if (this.callbacks.onRequestFail[url] &amp;&amp; typeof this.callbacks.onRequestFail[url].callback === 'function') { this.callbacks.onRequestFail[url].callback.call(this.callbacks.onRequestFail[url].context, form, jqXHR); } }, /** * Processing method on sumbit event * * @param {Object} form The jQuery DOM form element * @param {String} callbackName The callback function name * @param {Object} inputs The user inputs as object */ onJsCallback: function (form, callbackName, inputs) { if (this.jsCallbacks[callbackName] &amp;&amp; typeof this.jsCallbacks[callbackName].callback === 'function') { this.jsCallbacks[callbackName].callback.call(this.jsCallbacks[callbackName].context, form, inputs); } }, /** * Add a callback to process the url server success JSON repsonse * * The callback takes 2 arguments: * * - The jQuery DOM form element * - The server JSON reponse * * Example: function callback(form, data) { ... } * * @param {String} url The URL called to send the user data * @param {Function} callback The callback function * @param {Object} context The callback context */ addOnSuccessCallback: function (url, callback, context) { this.callbacks.onSuccess[url] = { &quot;callback&quot;: callback, &quot;context&quot; : context }; }, /** * Add a callback to process the url server fail JSON repsonse * * The callback takes 2 arguments: * * - The jQuery DOM form element * - The server JSON reponse * * Example: function callback(form, data) { ... } * * @param {String} url The URL called to send the user data * @param {Function} callback The callback function * @param {Object} context The callback context */ addOnFailCallback: function (url, callback, context) { this.callbacks.onFail[url] = { &quot;callback&quot;: callback, &quot;context&quot; : context }; }, /** * Add a callback to process the url server fail XHR * * The callback takes 2 arguments: * * - The jQuery DOM form element * - The jQuery jqXHR object * * Example: function callback(form, jqXHR) { ... } * * @param {String} url The URL called to send the user data * @param {Function} callback The callback function * @param {Object} context The callback context */ addOnRequestFailCallback: function (url, callback, context) { this.callbacks.onRequestFail[url] = { &quot;callback&quot;: callback, &quot;context&quot; : context }; }, /** * Add a callback to process the form user inputs on submit * * The callback takes 2 arguments: * * - The jQuery DOM form element * - The user inputs as object * * Example: function callback(form, inputs) { ... } * * @param {String} callbackName The callback function name * @param {Function} callback The callback function * @param {Object} context The callback context */ addJsCallback: function (callbackName, callback, context) { this.jsCallbacks[callbackName] = { &quot;callback&quot;: callback, &quot;context&quot; : context }; } }; return FormsManager; }); × Search results Close "},"message.js.html":{"id":"message.js.html","title":"Source: message.js","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Source: message.js /** * Message module * * @module lib/message */ define([ 'jquery', 'module' ], function ($, module) { 'use strict'; /** * Message object * * @constructor * @alias module:lib/message * @param {Object} settings Overriden settings */ var Message = function (settings) { this.settings = $.extend(true, {}, this.settings, settings); this.initEvents(); }; Message.prototype = { /** * Default settings will get overriden if they are set when the WebsocketManager will be instanciated */ &quot;settings&quot;: { &quot;alert&quot; : { &quot;divId&quot; : module.config().alert.divId, &quot;dismissClass&quot; : module.config().alert.dismissClass, &quot;defaultDuration&quot;: module.config().alert.defaultDuration, &quot;queue&quot; : [], &quot;lock&quot; : false }, &quot;popup&quot; : { &quot;divId&quot; : module.config().popup.divId, &quot;dismissClass&quot; : module.config().popup.dismissClass, &quot;defaultDuration&quot;: module.config().popup.defaultDuration, &quot;queue&quot; : [], &quot;lock&quot; : false }, &quot;notification&quot;: { &quot;divId&quot; : module.config().notification.divId, &quot;dismissClass&quot; : module.config().notification.dismissClass, &quot;defaultDuration&quot;: module.config().notification.defaultDuration, &quot;queue&quot; : [], &quot;lock&quot; : false }, &quot;serviceName&quot; : module.config().serviceName, &quot;defaultType&quot; : module.config().defaultType, &quot;defaultLevel&quot;: module.config().defaultLevel }, /** * Initialize events */ initEvents: function () { $('body').on( 'click', this.settings.alert.divId + ' ' + this.settings.alert.dismissClass, $.proxy(this.alertDismiss, this) ); $('body').on( 'click', this.settings.popup.divId + ' ' + this.settings.popup.dismissClass, $.proxy(this.popupDismiss, this) ); $('body').on( 'click', this.settings.notification.divId + ' ' + this.settings.notification.dismissClass, $.proxy(this.notificationDismiss, this) ); }, /** * Display a message on a large alert div at the top of the user screen * * @param {Object} message The message to display */ alert: function (message) { this.settings.alert.lock = true; // Var alert = $('#' + this.settings.alert.divId); console.log('alert', message); }, /** * Display a message on a modal to the user screen * * @param {Object} message The message to display */ popup: function (message) { this.settings.popup.lock = true; console.log('popup', message); }, /** * Display a message on a medium div at the bottom-right of the user screen * * @param {Object} message The message to display */ notification: function (message) { this.settings.notification.lock = true; console.log('notification', message); }, /** * Close the alert message */ alertDismiss: function () { if (this.settings.alert.lock) { console.log('alert dismiss'); this.settings.alert.lock = false; this.dequeueMessage('alert'); } }, /** * Close the popup message */ popupDismiss: function () { if (this.settings.popup.lock) { console.log('popup dismiss'); this.settings.popup.lock = false; this.dequeueMessage('popup'); } }, /** * Close the notification message */ notificationDismiss: function () { if (this.settings.notification.lock) { console.log('notification dismiss'); this.settings.notification.lock = false; this.dequeueMessage('notification'); } }, /** * Add a message in a specific queue to display it * * @param {String} text The message text to display * @param {String} type The message type (&quot;alert&quot;, &quot;popup&quot;, &quot;notification&quot;) * @param {String} level The message level (&quot;danger&quot;, &quot;warning&quot;, &quot;info&quot;, &quot;success&quot;) * @param {String} title The message title * @param {Number} duration The message maximum duration before dismiss (-1 for infinite) */ add: function (text, type, level, title, duration) { if (!type) { type = this.settings.defaultType; } this.settings[type].queue.push({ &quot;text&quot; : text, &quot;level&quot; : level || this.settings.defaultLevel, &quot;title&quot; : title || '', &quot;duration&quot;: duration || this.settings[type].defaultDuration }); this.dequeueMessage(type); }, /** * Parse the WebSocket server response to notify it * * @param {Object} data JSON encoded data recieved from the WebSocket server */ parseWebsocketData: function (data) { this.add(data.text, data.type, data.level, data.title, data.duration); }, /** * Dequeue a message from the specific queue if the queue is not empty and the queue is not locked * * @param {String} type The message type (&quot;alert&quot;, &quot;popup&quot;, &quot;notification&quot;) */ dequeueMessage: function (type) { var message, dismissMethod, self; if (!this.settings[type].lock) { message = this.settings[type].queue.shift(); dismissMethod = type + 'Dismiss'; self = this; if (message) { // Call the specific method to output the message this[type](message); // Auto dismiss the message after message.duration seconds setTimeout(function () { self[dismissMethod](); }, message.duration * 1000); } } } }; return Message; }); × Search results Close "},"user.js.html":{"id":"user.js.html","title":"Source: user.js","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Source: user.js /** * User module * * @module lib/user */ define([ 'jquery', 'module', 'message', 'bootstrap' ], function ($, module, Message) { 'use strict'; /** * UserManager object * * @constructor * @alias module:lib/user * @param {FormsManager} Forms A FormsManager to handle form XHR ajax calls or jsCallbacks * @param {Object} settings Overriden settings */ var UserManager = function (Forms, settings) { this.settings = $.extend(true, {}, this.settings, module.config(), settings); // Bind forms ajax callback Forms.addOnSuccessCallback('user/connect', this.connectSuccess, this); Forms.addOnFailCallback('user/connect', this.connectFail, this); Forms.addOnRequestFailCallback('user/connect', this.connectRequestFail, this); Forms.addOnSuccessCallback('user/register', this.registerSuccess, this); Forms.addOnFailCallback('user/register', this.registerFail, this); Forms.addOnRequestFailCallback('user/register', this.registerRequestFail, this); }, messageManager = new Message(); UserManager.prototype = { /** * Default settings will get overriden if they are set when the UserManager will be instanciated */ &quot;settings&quot; : { &quot;attributes&quot;: { &quot;firstName&quot;: &quot;&quot;, &quot;lastName&quot; : &quot;&quot;, &quot;pseudonym&quot;: &quot;&quot;, &quot;email&quot; : &quot;&quot;, &quot;password&quot; : &quot;&quot;, &quot;right&quot; : {}, &quot;chatRight&quot;: {} } }, /** * If the user is connected */ &quot;connected&quot;: false, /** * Callback when the user is successfully connected */ &quot;connectSuccessCallback&quot;: null, /** * Get first name * * @method getFirstName * @return {String} The user first name */ getFirstName: function () { return this.settings.attributes.firstName; }, /** * Get last name * * @method getLastName * @return {String} The user last name */ getLastName: function () { return this.settings.attributes.lastName; }, /** * Get pseudonym * * @method getPseudonym * @return {String} The user pseudonym */ getPseudonym: function () { var pseudonym = this.settings.attributes.pseudonym; if (pseudonym === '') { pseudonym = this.settings.attributes.firstName + ' ' + this.settings.attributes.lastName; } return pseudonym; }, /** * Get email * * @method getEmail * @return {String} The user email */ getEmail: function () { return this.settings.attributes.email; }, /** * Get password * * @return {String} The user password */ getPassword: function () { return this.settings.attributes.password; }, /** * Get user right * * @method getRight * @return {Array} The user right */ getRight: function () { return this.settings.attributes.right; }, /** * Get the given chat room right * * @method getChatRoomRight * @param {Number} roomId The room name * @return {Array} The user chat rights for the room */ getChatRoomRight: function (roomId) { return this.settings.attributes.chatRight[roomId]; }, /** * Tells if the user is connected * * @method isConnected * @return {Boolean} True if teh user is connected else false */ isConnected: function () { return this.connected === true; }, /** * Set the User object with a JSON parameter * * @method setAttributes * @param {Object} data JSON data */ setAttributes: function (data) { this.settings.attributes.firstName = data.user.firstName || &quot;&quot;; this.settings.attributes.lastName = data.user.lastName || &quot;&quot;; this.settings.attributes.pseudonym = data.user.pseudonym || &quot;&quot;; this.settings.attributes.email = data.user.email || &quot;&quot;; this.settings.attributes.password = data.user.password || &quot;&quot;; this.settings.attributes.chatRight = data.user.chatRight || {}; this.settings.attributes.right = data.user.right || {}; }, /** * Callback when the user connection attempt succeed * * @method connectSuccess * @param {Object} form The jQuery DOM form element * @param {Object} data The server JSON reponse */ connectSuccess: function (form, data) { this.setAttributes(data); this.connected = true; $(this.settings.selectors.modals.connect).modal('hide'); messageManager.add('Connect success !'); if (typeof this.connectSuccessCallback === 'function') { this.connectSuccessCallback.call(this); } }, /** * Callback when the user connection attempt failed * * @method connectFail * @param {Object} form The jQuery DOM form element * @param {Object} data The server JSON reponse */ connectFail: function (form, data) { console.log('Fail !', data); }, /** * Callback when the user connection request failed * * @method connectRequestFail * @param {Object} form The jQuery DOM form element * @param {Object} jqXHR The jQuery jqXHR object */ connectRequestFail: function (form, jqXHR) { console.log(jqXHR); }, /** * Callback when the user connection attempt succeed * * @method registerSuccess * @param {Object} form The jQuery DOM form element * @param {Object} data The server JSON reponse */ registerSuccess: function (form, data) { this.setAttributes(data); this.connected = true; messageManager.add('Register success !'); // @todo close the modal }, /** * Callback when the user connection attempt failed * * @method registerFail * @param {Object} form The jQuery DOM form element * @param {Object} data The server JSON reponse */ registerFail: function (form, data) { console.log('Fail !', data); }, /** * Callback when the user connection request failed * * @method registerRequestFail * @param {Object} form The jQuery DOM form element * @param {Object} jqXHR The jQuery jqXHR object */ registerRequestFail: function (form, jqXHR) { console.log(jqXHR); } }; return UserManager; }); × Search results Close "},"websocket.js.html":{"id":"websocket.js.html","title":"Source: websocket.js","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Source: websocket.js /** * Websocket module * * @module lib/websocket */ define([ 'jquery', 'module' ], function ($, module) { 'use strict'; /** * Websocket manager class * * @constructor * @alias module:lib/websocket * @param {User} User The current User * @param {Object} settings Overriden settings */ var WebsocketManager = function (User, settings) { this.settings = $.extend(true, {}, this.settings, settings); this.user = User; this.init(); }; WebsocketManager.prototype = { /** * Default settings will get overriden if they are set when the WebsocketManager will be instanciated */ &quot;settings&quot;: { &quot;serverUrl&quot; : module.config().serverUrl, &quot;serviceName&quot; : module.config().serviceName, &quot;waitInterval&quot;: module.config().waitInterval }, /** * The websocket ressource */ &quot;socket&quot;: {}, /** * The current User instance */ &quot;user&quot;: {}, /** * Callbacks method to process data recieved from the WebSocket server */ &quot;callbacks&quot;: {}, /** * Launch the WebSocket server and add the WebSocket server callbacks */ init: function () { this.connect(); this.addCallback(this.settings.serviceName, this.listServiceCallback, this); }, /** * Connect the client to the WebSocket server */ connect: function () { var self = this; try { this.socket = new WebSocket(this.settings.serverUrl); this.socket.onopen = function () { console.log('socket opened'); if (self.user.connected) { self.send(JSON.stringify({&quot;action&quot;: &quot;register&quot;, &quot;user&quot;: self.user.settings.attributes})); } }; this.socket.onclose = function () { console.log('socket closed'); }; this.socket.onerror = function () { console.log('socket error'); }; this.socket.onmessage = function (message) { self.treatData(message.data); }; } catch (error) { console.log(error); } }, /** * Shorthand method to send data to the WebSocket server or delay until the websocket is ready * * @param {String} data Data to send to the WebSocket server */ send: function (data) { var self = this; if (this.socket.readyState !== 1) { setTimeout(function () { self.send(data); }, self.settings.waitInterval); } else { this.socket.send(data); } }, /** * Disconnect the client from the WebSocket server */ disconnect: function () { this.socket.send(JSON.stringify({ &quot;action&quot;: &quot;disconnect&quot; })); }, /** * Treat data recieved from the WebSocket server * * @param {String} data The text data recieved from the WebSocket server */ treatData: function (data) { data = JSON.parse(data); console.log(data); if (data.service &amp;&amp; this.callbacks[data.service]) { this.callbacks[data.service].callback.call( this.callbacks[data.service].context, data ); } else { console.log(data); } }, /** * Add a callback to process data recieved from the WebSocket server * * @param {String} serviceName The callback service name * @param {Function} callback The callback function * @param {Object} context The callback context */ addCallback: function (serviceName, callback, context) { this.callbacks[serviceName] = { &quot;callback&quot;: callback, &quot;context&quot; : context }; }, /** * Add a service to the WebSocket server * * @param {String} serviceName The service name to add to the WebSocket server */ addService: function (serviceName) { this.socket.send(JSON.stringify({ &quot;action&quot; : &quot;manageServer&quot;, &quot;login&quot; : this.user.getEmail(), &quot;password&quot; : this.user.getPassword(), &quot;addService&quot;: serviceName })); }, /** * Remove a service from the WebSocket server * * @param {String} serviceName The service name to remove from the WebSocket server */ removeService: function (serviceName) { this.socket.send(JSON.stringify({ &quot;action&quot; : &quot;manageServer&quot;, &quot;login&quot; : this.user.getEmail(), &quot;password&quot; : this.user.getPassword(), &quot;removeService&quot;: serviceName })); }, /** * Query the currents running services from the WebSocket server */ listServices: function () { this.socket.send(JSON.stringify({ &quot;action&quot; : &quot;manageServer&quot;, &quot;login&quot; : this.user.getEmail(), &quot;password&quot; : this.user.getPassword(), &quot;listServices&quot;: true })); }, /** * Parse the WebSocket server response to retrieve the services list * * @param {Object} data JSON encoded data recieved from the WebSocket server */ listServiceCallback: function (data) { console.log(data.services); } }; return WebsocketManager; }); × Search results Close "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Modules Classes module:lib/chat module:lib/forms module:lib/message module:lib/user module:lib/websocket × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket websocket / webrtc chat video and audio serviceTechnical documentationdocumentation Features No flash, only html 5 native technology Shortcut copy / paste URL in a room to authorize a guest to join this room in one click Random room to connect automatically with another user randomly with / without microphone and webcam Thematic rooms User account interface Administraction interface Small devices support for smartphones and tablet As a guest user (pseudonym required only) Join public or private room View all the users in a public room View all the users in a private room with the right password Mute a user Display a user webcam Disable the webcam Become invisible in a room (not being shown in a public users list) As a registered user All guest user rights Create a public or private room View all users in a room (even invisible ones) Manage a room if the user has the room's admin right Kick / ban users Rename the room Change the password (or delete it) Change automatic voice / video activation on a room Change the maximum user authorized number in a room Mute a user globally in a room Disable a user webcam globally in a room Evolution Chat messages end to end encryption × Search results Close "},"module-lib_chat.html":{"id":"module-lib_chat.html","title":"Module: lib/chat","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Module: lib/chat Chat module new (require(&quot;lib/chat&quot;))(WebSocket, User, Forms, settings) ChatManager object Parameters: Name Type Description WebSocket WebSocket The websocket manager User User The current User Forms FormsManager A FormsManager to handle form XHR ajax calls or jsCallbacks settings Object Overriden settings Source: chat.js, line 36 To Do: check the id value of the followings this.mouseInRoomChat this.isRoomOpened this.messagesHistory this.messagesHistoryPointer this.messagesCurrent Members commands List of all commands name and regex Source: chat.js, line 78 isRoomOpened Monitor if a room is opened or not Source: chat.js, line 105 messagesCurrent The current user message (not sent) by room Source: chat.js, line 89 messagesHistory A messages sent history by room Source: chat.js, line 93 messagesHistoryPointer Pointer in the array messagesHistory by room Source: chat.js, line 97 mouseInRoomChat Monitor mouse position when it is in or out a room chat div Source: chat.js, line 101 promises Global promises handler Source: chat.js, line 72 serviceRunning If the service is currently running on the server Source: chat.js, line 113 settings Default settings will get overriden if they are set when the WebsocketManager will be instanciated Source: chat.js, line 66 user The current User instance Source: chat.js, line 109 websocket The WebsocketManager instance Source: chat.js, line 85 Methods initEvents() Initialize all the events Source: chat.js, line 124 &lt;inner&gt; banUser(roomId, pseudonym, reason) Ban a user from a room Parameters: Name Type Description roomId Number The room ID pseudonym String The user pseudonym to ban reason String OPTIONAL the reason of the ban Source: chat.js, line 682 &lt;inner&gt; banUserCallback(data) Callback after banning a user from a room Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 953 &lt;inner&gt; banUserEvent(e) Event fired when a user wants to ban another user from a room in the administration panel Parameters: Name Type Description e event The fired event Source: chat.js, line 495 &lt;inner&gt; changeRoomInfoCallback(data) Callback after a room name / password has been changed Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 973 &lt;inner&gt; chatCallback(data) Handle the WebSocker server response and process action then Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 760 &lt;inner&gt; chatTextKeyPressEvent(e) Event fired when a user press a key in a chat message input Parameters: Name Type Description e event The fired event Source: chat.js, line 331 &lt;inner&gt; closeRoomEvent(e) Event fired when a user wants to close a room Parameters: Name Type Description e event The fired event Source: chat.js, line 315 &lt;inner&gt; connect(pseudonym, roomId, password) Connect a user to the chat Parameters: Name Type Description pseudonym String The user pseudonym roomId Number The room ID to connect to password String The room password to connect to Source: chat.js, line 574 &lt;inner&gt; connectEvent() Event fired when a user want to connect to a chat Source: chat.js, line 236 &lt;inner&gt; connectRoomCallback(data) Callback after a user attempted to connect to a room Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 774 &lt;inner&gt; createRoom(roomName, type, password, maxUsers) Create a chat room Parameters: Name Type Description roomName String The room name type String The room type ('public' || 'private') password String The room password maxUsers Number The max users number Source: chat.js, line 626 &lt;inner&gt; createRoomCallback(data) Callback after a user attempted to create a room Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 857 &lt;inner&gt; createRoomEvent() Event fired when a user wants to create a chat room Source: chat.js, line 250 &lt;inner&gt; disconnect(roomId) Disconnect a user from a chat room Parameters: Name Type Description roomId Number The room ID to disconnect to Source: chat.js, line 592 &lt;inner&gt; disconnectRoomCallback(data) Callback after a user attempted to disconnect from a room Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 788 &lt;inner&gt; displayRoomEvent(e) Event fired when a user wants to display a room Parameters: Name Type Description e event The fired event Source: chat.js, line 265 &lt;inner&gt; formatUserMessage(data) Format a user message in a html div Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 1149 Returns: Array of jQuery html div(s) object containing the user message(s) Type Array &lt;inner&gt; fullscreenRoomEvent(e) Event fired when a user wants to fullscreen / reduce a room Parameters: Name Type Description e event The fired event Source: chat.js, line 295 &lt;inner&gt; getBannedCallback(data) Callback after being banned from a room Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 943 &lt;inner&gt; getHistoric(roomId, password, historicLoaded) Get room chat historic Parameters: Name Type Description roomId Number The room ID password String The room password historicLoaded Number The number of historic already loaded Source: chat.js, line 646 &lt;inner&gt; getHistoricCallback(data) Callback after a user attempted to laod more historic of a conversation Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 909 &lt;inner&gt; getHistoricEvent(e) Event fired when a user wants to get more historic of a conversation Parameters: Name Type Description e event The fired event Source: chat.js, line 394 &lt;inner&gt; getKickedCallback(data) Callback after being kicked from a room Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 923 &lt;inner&gt; getRoomsInfo() Get the rooms basic information (name, type, usersMax, usersConnected) Source: chat.js, line 742 &lt;inner&gt; getRoomsInfoCallback(data) Callback after getting the new rooms info Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 1010 &lt;inner&gt; getUserRightLine(modal, pseudonym, userChatRight) Get a new user right line in the administration panel Parameters: Name Type Description modal Object The modal jQuery DOM element pseudonym String The new user pseudonym userChatRight Object The new user chat right Source: chat.js, line 1247 Returns: The new user right line jQuery DOM element Type Object &lt;inner&gt; insertRoomInDOM(data) Insert a room in the user DOM with data recieved from server Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 1050 &lt;inner&gt; isCommand(message, roomName, password) Check if the user input is a command and process it Parameters: Name Type Description message String The user input roomName String The room name password String The room password Source: chat.js, line 1332 Returns: True if the user input was a command else false Type Boolean &lt;inner&gt; kickUser(roomId, pseudonym, reason) Kick a user from a room Parameters: Name Type Description roomId Number The room ID pseudonym String The user pseudonym to kick reason String OPTIONAL the reason of the kick Source: chat.js, line 664 &lt;inner&gt; kickUserCallback(data) Callback after kicking a user from a room Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 933 &lt;inner&gt; kickUserEvent(e) Event fired when a user wants to kick another user from a room in the administration panel Parameters: Name Type Description e event The fired event Source: chat.js, line 473 &lt;inner&gt; loadHistoric(roomChatDOM, historic) Load conversations historic sent by the server Parameters: Name Type Description roomChatDOM Object The room chat jQuery DOM element to insert the conversations historic in historic Object The conversations historic Source: chat.js, line 1129 &lt;inner&gt; minimizeRoomEvent(e) Event fired when a user wants to minimize a room Parameters: Name Type Description e event The fired event Source: chat.js, line 279 &lt;inner&gt; mouseEnterRoomChatEvent(e) Event fired when the user mouse enters the room chat div Parameters: Name Type Description e event The fired event Source: chat.js, line 426 &lt;inner&gt; mouseLeaveRoomChatEvent(e) Event fired when the user mouse leaves the room chat div Parameters: Name Type Description e event The fired event Source: chat.js, line 438 &lt;inner&gt; recieveMessageCallback(data) Callback after a user recieved a message Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 871 &lt;inner&gt; selectRoomEvent(e) Event fired when a user selected a room Parameters: Name Type Description e event The fired event Source: chat.js, line 554 &lt;inner&gt; selectUserEvent(e) Event fired when a user wants to select a reciever for his message Parameters: Name Type Description e event The fired event Source: chat.js, line 409 &lt;inner&gt; sendMessage(recievers, message, roomId, password) Send a message to all the users in the chat room or at one user in the chat room Parameters: Name Type Description recievers String The message reciever ('all' || userPseudonym) message String The txt message to send roomId Number The chat room name password String The chat room password if required Source: chat.js, line 606 &lt;inner&gt; sendMessageCallback(data) Callback after a user sent a message Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 897 &lt;inner&gt; sendMessageEvent(e) Event fired when a user wants to send a message Parameters: Name Type Description e event The fired event Source: chat.js, line 364 &lt;inner&gt; setAministrationPanelEvent(e) Event fired when the user wants to display the administration room panel Parameters: Name Type Description e event The fired event Source: chat.js, line 450 &lt;inner&gt; setReasonCallbackEvent(form, inputs) Set the reason of the admin kick / ban action Parameters: Name Type Description form Object The jQuery DOM form element inputs Object The user inputs as object Source: chat.js, line 517 &lt;inner&gt; setRoomInfo(roomId, oldRoomName, newRoomName, oldRoomPassword, newRoomPassword) Set a new room name / password Parameters: Name Type Description roomId Number The room ID oldRoomName String The old room name newRoomName String The new room name oldRoomPassword String The old room password newRoomPassword String The new room password Source: chat.js, line 720 &lt;inner&gt; setRoomInfoCallback(data) Callback after setting a new room name / password Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 963 &lt;inner&gt; setRoomInfoCallbackEvent(form, inputs) Set the room name / password Parameters: Name Type Description form Object The jQuery DOM form element inputs Object The user inputs as object Source: chat.js, line 534 &lt;inner&gt; toggleAdministrationRights(e) Event fired when the user wants to display a user rights in administration modal Parameters: Name Type Description e event The fired event Source: chat.js, line 463 &lt;inner&gt; updateRoomUserRight(roomId, pseudonym, rightName, rightValue) Update a user right Parameters: Name Type Description roomId Number The room ID pseudonym String The user pseudonym rightName String The right name to update rightValue Boolean The new right value Source: chat.js, line 700 &lt;inner&gt; updateRoomUsersBanned(modal, usersBanned) Update the ip banned list in the administration modal Parameters: Name Type Description modal Object The modal jQuery DOM element usersBanned Object The users banned object returned by the server Source: chat.js, line 1303 &lt;inner&gt; updateRoomUsersBannedCallback(data) Callback after a user get banned or unbanned from a room Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 845 &lt;inner&gt; updateRoomUsersCallback(data) Callback after a user joined or left the room Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 798 &lt;inner&gt; updateRoomUsersRights(modal, usersRights) Update the users list in the administration modal Parameters: Name Type Description modal Object The modal jQuery DOM element usersRights Object The users rights object returned by the server Source: chat.js, line 1222 &lt;inner&gt; updateRoomUsersRightsCallback(data) Callback after a registered user entered or left the room Parameters: Name Type Description data Object The server JSON reponse Source: chat.js, line 833 &lt;inner&gt; updateUsersDropdown(room, pseudonyms) Update the users list in the dropdown menu recievers Parameters: Name Type Description room Object The room jQuery DOM element pseudonyms Array The new pseudonyms list Source: chat.js, line 1188 × Search results Close "},"module-lib_forms.html":{"id":"module-lib_forms.html","title":"Module: lib/forms","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Module: lib/forms Forms module new (require(&quot;lib/forms&quot;))(settings) FormsManager object Parameters: Name Type Description settings Object Overriden settings Source: forms.js, line 21 Members callbacks Callbacks methods to process specifics responses on a XHR server response Source: forms.js, line 39 jsCallbacks Callbacks methods to process users input on user sumbit action Source: forms.js, line 47 settings Default settings will get overriden if they are set when the FormsManager will be instanciated Source: forms.js, line 30 xhrs The currents xhr processing Source: forms.js, line 35 Methods addJsCallback(callbackName, callback, context) Add a callback to process the form user inputs on submit The callback takes 2 arguments: - The jQuery DOM form element - The user inputs as object Example: function callback(form, inputs) { ... } Parameters: Name Type Description callbackName String The callback function name callback function The callback function context Object The callback context Source: forms.js, line 230 addOnFailCallback(url, callback, context) Add a callback to process the url server fail JSON repsonse The callback takes 2 arguments: - The jQuery DOM form element - The server JSON reponse Example: function callback(form, data) { ... } Parameters: Name Type Description url String The URL called to send the user data callback function The callback function context Object The callback context Source: forms.js, line 188 addOnRequestFailCallback(url, callback, context) Add a callback to process the url server fail XHR The callback takes 2 arguments: - The jQuery DOM form element - The jQuery jqXHR object Example: function callback(form, jqXHR) { ... } Parameters: Name Type Description url String The URL called to send the user data callback function The callback function context Object The callback context Source: forms.js, line 209 addOnSuccessCallback(url, callback, context) Add a callback to process the url server success JSON repsonse The callback takes 2 arguments: - The jQuery DOM form element - The server JSON reponse Example: function callback(form, data) { ... } Parameters: Name Type Description url String The URL called to send the user data callback function The callback function context Object The callback context Source: forms.js, line 167 initEvents() Bind events on all form Source: forms.js, line 52 onFail(form, url, data) Processing method on server fail response Parameters: Name Type Description form Object The jQuery DOM form element url String The URL called to send the user data data Object The server JSON reponse Source: forms.js, line 121 onJsCallback(form, callbackName, inputs) Processing method on sumbit event Parameters: Name Type Description form Object The jQuery DOM form element callbackName String The callback function name inputs Object The user inputs as object Source: forms.js, line 147 onRequestFail(form, url, jqXHR) Processing method on XHR error Parameters: Name Type Description form Object The jQuery DOM form element url String The URL called to send the user data jqXHR Object The jQuery jqXHR object Source: forms.js, line 134 onSuccess(form, url, data) Processing method on server success response Parameters: Name Type Description form Object The jQuery DOM form element url String The URL called to send the user data data Object The server JSON reponse Source: forms.js, line 108 submit(e) Process the form with specified method in the data-send-action HTML attribute (default AJAX call) Parameters: Name Type Description e event The form submit event Source: forms.js, line 61 × Search results Close "},"module-lib_message.html":{"id":"module-lib_message.html","title":"Module: lib/message","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Module: lib/message Message module new (require(&quot;lib/message&quot;))(settings) Message object Parameters: Name Type Description settings Object Overriden settings Source: message.js, line 20 Members settings Default settings will get overriden if they are set when the WebsocketManager will be instanciated Source: message.js, line 29 Methods add(text, type, level, title, duration) Add a message in a specific queue to display it Parameters: Name Type Description text String The message text to display type String The message type (&quot;alert&quot;, &quot;popup&quot;, &quot;notification&quot;) level String The message level (&quot;danger&quot;, &quot;warning&quot;, &quot;info&quot;, &quot;success&quot;) title String The message title duration Number The message maximum duration before dismiss (-1 for infinite) Source: message.js, line 152 alert(message) Display a message on a large alert div at the top of the user screen Parameters: Name Type Description message Object The message to display Source: message.js, line 84 alertDismiss() Close the alert message Source: message.js, line 113 dequeueMessage(type) Dequeue a message from the specific queue if the queue is not empty and the queue is not locked Parameters: Name Type Description type String The message type (&quot;alert&quot;, &quot;popup&quot;, &quot;notification&quot;) Source: message.js, line 181 initEvents() Initialize events Source: message.js, line 59 notification(message) Display a message on a medium div at the bottom-right of the user screen Parameters: Name Type Description message Object The message to display Source: message.js, line 105 notificationDismiss() Close the notification message Source: message.js, line 135 parseWebsocketData(data) Parse the WebSocket server response to notify it Parameters: Name Type Description data Object JSON encoded data recieved from the WebSocket server Source: message.js, line 172 popup(message) Display a message on a modal to the user screen Parameters: Name Type Description message Object The message to display Source: message.js, line 95 popupDismiss() Close the popup message Source: message.js, line 124 × Search results Close "},"module-lib_user.html":{"id":"module-lib_user.html","title":"Module: lib/user","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Module: lib/user User module new (require(&quot;lib/user&quot;))(Forms, settings) UserManager object Parameters: Name Type Description Forms FormsManager A FormsManager to handle form XHR ajax calls or jsCallbacks settings Object Overriden settings Source: user.js, line 23 Members connected If the user is connected Source: user.js, line 53 connectSuccessCallback Callback when the user is successfully connected Source: user.js, line 57 settings Default settings will get overriden if they are set when the UserManager will be instanciated Source: user.js, line 39 Methods getPassword() Get password Source: user.js, line 110 Returns: The user password Type String &lt;inner&gt; connectFail(form, data) Callback when the user connection attempt failed Parameters: Name Type Description form Object The jQuery DOM form element data Object The server JSON reponse Source: user.js, line 180 &lt;inner&gt; connectRequestFail(form, jqXHR) Callback when the user connection request failed Parameters: Name Type Description form Object The jQuery DOM form element jqXHR Object The jQuery jqXHR object Source: user.js, line 191 &lt;inner&gt; connectSuccess(form, data) Callback when the user connection attempt succeed Parameters: Name Type Description form Object The jQuery DOM form element data Object The server JSON reponse Source: user.js, line 161 &lt;inner&gt; getChatRoomRight(roomId) Get the given chat room right Parameters: Name Type Description roomId Number The room name Source: user.js, line 124 Returns: The user chat rights for the room Type Array &lt;inner&gt; getEmail() Get email Source: user.js, line 95 Returns: The user email Type String &lt;inner&gt; getFirstName() Get first name Source: user.js, line 59 Returns: The user first name Type String &lt;inner&gt; getLastName() Get last name Source: user.js, line 69 Returns: The user last name Type String &lt;inner&gt; getPseudonym() Get pseudonym Source: user.js, line 79 Returns: The user pseudonym Type String &lt;inner&gt; getRight() Get user right Source: user.js, line 114 Returns: The user right Type Array &lt;inner&gt; isConnected() Tells if the user is connected Source: user.js, line 135 Returns: True if teh user is connected else false Type Boolean &lt;inner&gt; registerFail(form, data) Callback when the user connection attempt failed Parameters: Name Type Description form Object The jQuery DOM form element data Object The server JSON reponse Source: user.js, line 216 &lt;inner&gt; registerRequestFail(form, jqXHR) Callback when the user connection request failed Parameters: Name Type Description form Object The jQuery DOM form element jqXHR Object The jQuery jqXHR object Source: user.js, line 227 &lt;inner&gt; registerSuccess(form, data) Callback when the user connection attempt succeed Parameters: Name Type Description form Object The jQuery DOM form element data Object The server JSON reponse Source: user.js, line 202 &lt;inner&gt; setAttributes(data) Set the User object with a JSON parameter Parameters: Name Type Description data Object JSON data Source: user.js, line 145 × Search results Close "},"module-lib_websocket.html":{"id":"module-lib_websocket.html","title":"Module: lib/websocket","body":" WebSocket services / AMD modules Modules lib/chatlib/formslib/messagelib/userlib/websocket Module: lib/websocket Websocket module new (require(&quot;lib/websocket&quot;))(User, settings) Websocket manager class Parameters: Name Type Description User User The current User settings Object Overriden settings Source: websocket.js, line 21 Members callbacks Callbacks method to process data recieved from the WebSocket server Source: websocket.js, line 47 settings Default settings will get overriden if they are set when the WebsocketManager will be instanciated Source: websocket.js, line 31 socket The websocket ressource Source: websocket.js, line 39 user The current User instance Source: websocket.js, line 43 Methods addCallback(serviceName, callback, context) Add a callback to process data recieved from the WebSocket server Parameters: Name Type Description serviceName String The callback service name callback function The callback function context Object The callback context Source: websocket.js, line 142 addService(serviceName) Add a service to the WebSocket server Parameters: Name Type Description serviceName String The service name to add to the WebSocket server Source: websocket.js, line 154 connect() Connect the client to the WebSocket server Source: websocket.js, line 60 disconnect() Disconnect the client from the WebSocket server Source: websocket.js, line 110 init() Launch the WebSocket server and add the WebSocket server callbacks Source: websocket.js, line 52 listServiceCallback(data) Parse the WebSocket server response to retrieve the services list Parameters: Name Type Description data Object JSON encoded data recieved from the WebSocket server Source: websocket.js, line 194 listServices() Query the currents running services from the WebSocket server Source: websocket.js, line 180 removeService(serviceName) Remove a service from the WebSocket server Parameters: Name Type Description serviceName String The service name to remove from the WebSocket server Source: websocket.js, line 168 send(data) Shorthand method to send data to the WebSocket server or delay until the websocket is ready Parameters: Name Type Description data String Data to send to the WebSocket server Source: websocket.js, line 95 treatData(data) Treat data recieved from the WebSocket server Parameters: Name Type Description data String The text data recieved from the WebSocket server Source: websocket.js, line 121 × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
