<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: navigation.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: navigation.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Navigation module
 *
 * Handle the current page attributes such as the page title or the page parameters.
 * It loads pages by hide / show pages DOM classes elements to use a Single Page Web pattern and avoiding browser
 * page reloading to keep the WebSocket connection alive.
 * It load pages on hashchange event and detect the page to load by parsing the hash.
 *
 * @module               lib/navigation
 */

define([
    'jquery',
    'module',
    'lodash'
], function ($, module, _) {
    'use strict';

    /**
     * Navigation object
     *
     * @constructor
     * @alias       module:lib/navigation
     * @param       {Object}       settings Overriden settings
     */
    var Navigation = function (settings) {
        this.settings = $.extend(true, {}, this.settings, module.config(), settings);
        this.initEvents();
    };

    Navigation.prototype = {
        /*====================================================
        =            Object settings / properties            =
        ====================================================*/

        /**
         * Default settings
         */
        "settings" : {},
        /**
         * Current jQuery DOM element page
         */
        "page": {},
        /**
         * Current page URL (hash URL)
         */
        "pageUrl": "",
        /**
         * Current page Title
         */
        "pageTitle": "",
        /**
         * Current page parameters
         */
        "pageParameters": {},
        /**
         * Callbacks method to run actions on specific pages on loaded
         */
        "callbacks": {},

        /*=====  End of Object settings / properties  ======*/

        /*==============================
        =            Events            =
        ==============================*/

        /**
         * Initialize all the events
         *
         * @method     initEvents
         */
        initEvents: function () {
            $(window).on('hashchange', $.proxy(this.loadPageFromHash, this));
            $('body').on('click', this.settings.selectors.pageLink, $.proxy(this.openLink, this));
        },

        /**
         * Load a page when the page hash changes
         *
         * @method     loadPageFromHash
         * @return     {Boolean}  True if a page was loaded else false
         */
        loadPageFromHash: function () {
            var hash       = location.hash,
                pageUrl    = _.trimStart(_.head(_.split(hash, '?')), this.settings.urlPrefix),
                pageLoaded = false;

            if (_.startsWith(hash, this.settings.urlPrefix) &amp;&amp; this.pageUrl !== pageUrl) {
                this.loadPageParameters(hash);
                this.loadPage(pageUrl);
                pageLoaded = true;
            }

            return pageLoaded;
        },

        /**
         * Display the page called on a page-link click
         *
         * @method     openLink
         * @param      {Event}  e       The event fired
         */
        openLink: function (e) {
            var url = $(e.currentTarget).attr('href') || $(e.currentTarget).attr('data-url');

            e.preventDefault();

            if (location.hash !== url) {
                this.loadPage(url);
            }
        },

        /*=====  End of Events  ======*/

        /*===============================
        =            Getters            =
        ===============================*/

        getPage: function () {
            return this.page;
        },

        /**
         * Get the current page URL (hash URL)
         *
         * @method     getPageUrl
         * @return     {String}  The current page URL (hash URL)
         */
        getPageUrl: function () {
            return this.pageUrl;
        },

        /**
         * Get the current page title
         *
         * @method     getPageTitle
         * @return     {String}  The current page title
         */
        getPageTitle: function () {
            return this.pageTitle;
        },

        /**
         * Get the current page parameters
         *
         * @method     getPageParameters
         * @return     {Object}  The current page parameters
         */
        getPageParameters: function () {
            return this.pageParameters;
        },

        /*=====  End of Getters  ======*/

        /*=========================================
        =            Utilities methods            =
        =========================================*/

        /**
         * Display a page by hide / show DOM elements and set pages attributes
         *
         * @method     loadPage
         * @param      {String}  pageUrl  The page URL to load
         */
        loadPage: function (pageUrl) {
            var currentPage = $(this.settings.selectors.currentPage),
                newPage     = $(this.settings.selectors.page + '[data-url="' + pageUrl + '"]'),
                pageTitle   = newPage.attr('data-title');
            // Check if the page exists
            if (!newPage || newPage.length &lt; 1) {
                // @todo display error with message ?
                console.log('Page not found');
            } else {
                // Set page title
                $('title').html(pageTitle);
                // Hide the current page if exists
                if (currentPage.length > 0) {
                    currentPage.hide();
                    currentPage.removeClass(this.settings.selectors.currentPage.substr(1));
                }
                // Display the page
                newPage.show();
                newPage.addClass(this.settings.selectors.currentPage.substr(1));
                // Set the URL hash
                if (location.hash !== this.settings.urlPrefix + pageUrl) {
                    location.hash = this.settings.urlPrefix + pageUrl;
                }
                // Set self attributes
                this.page      = newPage;
                this.pageUrl   = pageUrl;
                this.pageTitle = pageTitle;
                // Run the callback if it is set
                if (this.callbacks[pageUrl]) {
                    this.callbacks[pageUrl].callback.call(this.callbacks[pageUrl].context);
                }
            }
        },

        /**
         * Load current page parameters in parsing the given URL hash
         *
         * @method     loadPageParameters
         * @param      {String}  hash    The URL hash
         */
        loadPageParameters: function (hash) {
            var parametersRaw = _.split(hash, '?'),
                parameters    = {},
                split;

            if (_.size(parametersRaw[1]) > 0) {
                parametersRaw = _.split(parametersRaw[1], '&amp;');

                _.forEach(parametersRaw, function (parameter) {
                    split                = _.split(parameter, '=');
                    parameters[split[0]] = split[1];
                });

                this.parameters = parameters;
            }
        },

        /**
         * Load the landing page
         *
         * @method     loadLandingPage
         */
        loadLandingPage: function () {
            if (!this.loadPageFromHash()) {
                this.loadPage(this.settings.landingPage);
            }
        },

        /**
         * Add a callback to process data recieved from the WebSocket server
         *
         * @method     addCallback
         * @param      {String}    pageUrl   The callback page
         * @param      {Function}  callback  The callback function
         * @param      {Object}    context   The callback context (null to use the navigation this context)
         */
        addCallback: function (pageUrl, callback, context) {
            this.callbacks[pageUrl] = {
                "callback": callback,
                "context" : context || this
            };
        }

        /*=====  End of Utilities methods  ======*/
    };

    return Navigation;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="lib_client%250A%250AClient%2520object%2520to%2520handle%2520all%2520client%2520attributesmodule_.html">lib/client

Client object to handle all client attributes</a></li><li><a href="lib_iframe%250A%250AHelper%2520class%2520to%2520integrate%2520iframe%2520in%2520a%2520page%2520without%2520scroll%2520barre%2520and%2520in%2520full%2520width%2520_%2520height%2520well%2520integrated%2520on%2520the%250Apagemodule_.html">lib/iframe

Helper class to integrate iframe in a page without scroll barre and in full width / height well integrated on the
page</a></li><li><a href="lib_room%250A%250ARoom%2520object%2520to%2520handle%2520all%2520room%2520attributesmodule_.html">lib/room

Room object to handle all room attributes</a></li><li><a href="lib_roomManager%250A%250ARoomManager%2520object%2520to%2520handle%2520all%2520room%2520Objectmodule_.html">lib/roomManager

RoomManager object to handle all room Object</a></li><li><a href="module-lib_chat.html">lib/chat</a></li><li><a href="module-lib_clientManager.html">lib/clientManager</a></li><li><a href="module-lib_forms.html">lib/forms</a></li><li><a href="module-lib_message.html">lib/message</a></li><li><a href="module-lib_navigation.html">lib/navigation</a></li><li><a href="module-lib_user.html">lib/user</a></li><li><a href="module-lib_userManager.html">lib/userManager</a></li><li><a href="module-lib_websocket.html">lib/websocket</a></li></ul><h3>Classes</h3><ul><li><a href="-_.html">_</a></li><li><a href="module-lib_chat.html">lib/chat</a></li><li><a href="module-lib_client.html">lib/client</a></li><li><a href="module-lib_clientManager.html">lib/clientManager</a></li><li><a href="module-lib_forms.html">lib/forms</a></li><li><a href="module-lib_iframe.html">lib/iframe</a></li><li><a href="module-lib_message.html">lib/message</a></li><li><a href="module-lib_navigation.html">lib/navigation</a></li><li><a href="module-lib_room.html">lib/room</a></li><li><a href="module-lib_roomManager.html">lib/roomManager</a></li><li><a href="module-lib_user.html">lib/user</a></li><li><a href="module-lib_userManager.html">lib/userManager</a></li><li><a href="module-lib_websocket.html">lib/websocket</a></li></ul><h3>Global</h3><ul><li><a href="global.html#requirejs">requirejs</a></li><li><a href="global.html#toUrl">toUrl</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sat May 07 2016 12:07:24 GMT+0200 (Paris, Madrid (heure d’été))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
